# Data Pipeline: execute.py + CI + Pages

## Overview

This project provides a fixed execute.py script and a GitHub Actions workflow to lint, run, and publish results:

- execute.py:
  - Python 3.11+ compatible
  - Uses Pandas 2.3
  - Reads data.csv (converted from data.xlsx)
  - Computes:
    - row_count
    - regions_count
    - top 3 products by total revenue
    - rolling_7d_revenue_by_region: last value of a 7-day time-based moving average of daily revenue for each region
- .github/workflows/ci.yml:
  - Installs Python 3.11, Pandas 2.3, openpyxl, and ruff
  - Runs Ruff and shows output in CI logs
  - Runs: python execute.py > result.json
  - Publishes result.json via GitHub Pages

Important: Do not commit result.json; it is generated by CI and published to GitHub Pages.

## Setup

1. Prerequisites
   - Python 3.11+
   - GitHub repository with Actions enabled
   - Git installed locally

2. Dependencies (local, optional; CI installs them automatically)
   - pip install "pandas==2.3.*" openpyxl ruff

3. Files to add/commit
   - execute.py (fixed)
   - data.csv (converted from data.xlsx)
   - .github/workflows/ci.yml
   - Optionally .gitignore containing result.json to avoid accidental commit

## Usage

1. Convert data.xlsx to data.csv
   - Use your own tooling or the included web UI to convert the provided data.xlsx into data.csv.
   - Ensure the CSV retains the columns: date, region, product, units, price.
   - Place data.csv at the repository root.
   - Do not commit result.json.

2. Run locally (optional)
   - python execute.py > result.json
   - Inspect the output:
     - row_count
     - regions_count
     - top_n_products_by_revenue (n=3)
     - rolling_7d_revenue_by_region

3. Commit and push
   - git add execute.py data.csv .github/workflows/ci.yml
   - git commit -m "Fix execute.py, add CI workflow, and add data.csv"
   - git push

4. GitHub Actions
   - Workflow will:
     - Install Python 3.11 and dependencies (Pandas 2.3, openpyxl, ruff)
     - Run Ruff and display results in the job logs
     - Execute python execute.py > result.json
     - Publish result.json to GitHub Pages

5. Accessing result.json
   - After the Deploy Pages step completes, visit the URL shown in the “deploy” job output (Environment URL).
   - Access result.json directly at the root of that Pages site: https://<your-username>.github.io/<your-repo>/result.json

Notes:
- The original bug in execute.py related to revenue aggregation and a misspelled column in the rolling calculation was fixed. The script now:
  - Aggregates revenue correctly by product
  - Uses the correct "revenue" column throughout (no "revenew" typo)
  - Applies a time-based 7D rolling mean on daily revenue per region
- The script reads data.csv to avoid needing the Excel engine in the runtime; the CI still installs openpyxl for completeness.